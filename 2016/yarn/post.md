# A first-hand Yarn experience

I'm always skeptical of the new "cool" tools. Especially in the JavaScript world where we see multiple frameworks and libraries released every hour. So, I wasn't sure if [Yarn](https://yarnpkg.com/) will be so much better then [npm](https://npmjs.org). Well, it looked like it gave me an answer of several things.

## Consistent builds

There's not a discipline around semantic versioning in the JavaScript community. People publish stuff by upgrading *patch* version where they mean a *major* one. Or they introduce breaking changes and don't update the version accordantly. Together with the freedom of npm's semver ranges leads to a complete mess where builds fail and people ask "But why!". I already [touched on this subject](http://krasimirtsonev.com/blog/article/thoughts-on-semantic-versioning-npm-and-JavaScript-ecosystem) but didn't actually reached any solution whatsoever.

The biggest problem of npm is the inconsistent state of dependencies after the `npm install` call. This means that you may run `npm install` and get a different output every time. That's I believe what npm v3 aims to solve and as far as I know it's really close to what Yarn offers.

*Disclaimer: what I'm talking about in this article could be fully doable with [`npm-shrinkwrap`](https://docs.npmjs.com/cli/shrinkwrap). I just find Yarn managing everything instead of me.*

So, Yarn does indeed gets all the dependencies installed under `node_modules` folder but also provides an `yarn.lock` file. A file that lists all the modules and their exact version. This leads to reproducible builds because the client (Yarn) downloads a specific versions from the registry (npm). Here's an example:

```
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1
compilify@~0.1.0:
  version "0.1.0"
  resolved "https://registry.yarnpkg.com/compilify/-/compilify-0.1.0.tgz#9d48393635eae142502095ae7cfcd9dea4c33db7"
  dependencies:
    through "~2.3.4"

through@~2.3.4:
  version "2.3.8"
  resolved "https://registry.yarnpkg.com/through/-/through-2.3.8.tgz#0dd4c9ffaabc357960b1b724115d7e0e86a2e1f5"
```

## The problem

I'll give you a [problem that I hit](https://github.com/yarnpkg/yarn/issues/1571) today and will show you how I used the `yarn.lock` file to solve it. It was again an issue with semver ranges.

A project of mine depends on two modules [`ractive`](https://www.npmjs.com/package/ractive) and [`ractivate`](https://www.npmjs.com/package/ractivate). The first one is a library for building UI (similarly to React) and the second one is a browserify transform plugin for pre-parsing Ractive templates. It's fine that `ractivate` has `ractive` as dependency because it can't function without it. The thing is that my projects depends on `0.6.1` of `ractive` and `ractivate` depends on `0.x` version. This leads to:

```
my-project
  node_modules
    ractive (0.6.1)
    ractivate
      node_modules
        ractive (0.8.2)
```

So when ractivate pre-parse the templates it uses version 0.8.3
